---
title: "Baseball"
author: "Ryan Moorhead"
date: "12/7/2018"
output: html_notebook
  
---

```{r setup, include=FALSE}
library(DataComputing)
library(mosaic)
library(tidyverse)
library(ggplot2)
library(rpart.plot)
```

Putting the data from csv files in GitHub to tables

```{r}
Batting <- read.csv("2018 Batting Stats Min. 50 AB.csv")
Pitching <- read.csv("2018 Pitching Stats Min. 10 IP.csv")
FansBat <- read.csv("Fans 2018 Batting Projections.csv")
FansPitch <- read.csv("Fans 2018 Pitching Projections.csv")
SteamBat <- read.csv("Steamer 2018 Batting Projections.csv")
SteamPitch <- read.csv("Steamer 2018 Pitching Projections.csv")
ZipsBat <- read.csv("ZiPS 2018 Batting Projections.csv")
ZipsPitch <- read.csv("ZiPS 2018 Pitching Projections.csv")
```

Viewing the Data

The cases themselves seem to be workable, nothing to change, but the names of the variables are quite messed up.

```{r}
Batting %>%
  head(3)
Pitching %>%
  head(3)
FansBat %>%
  head(3)
FansPitch %>%
  head(3)
SteamBat %>%
  head(3)
SteamPitch %>%
  head(3)
ZipsBat %>%
  head(3)
ZipsPitch %>%
  head(3)

```

Only renaming the actual 2018 stats, as I will be using them for most of the analysis, and the projections are just for comparing Wins above Replacement
```{r}
names(Batting) <- c("name", "team", "games", "pa", "homeruns", "runs", "rbi", "steals", "walkpercentage", "strikeoutpercentage", "iso", "babip", "average", "obp", "slugging", "woba", "wrc", "bsr","oruns", "druns", "war", "playerid")

names(Pitching) <-c("name", "team", "wins", "loses", "saves", "games", "gamesstarted", "innings", "strikeoutper9", "walksper9", "homerunsper9", "babip", "lob", "gb", "hrperfb", "era", "fip", "xfip", "war", "playerid")

FansBat <- FansBat %>%
  rename(fanwar = WAR, name = ï..Name, pid = playerid)
FansPitch <- FansPitch %>%
  rename(fanwar = WAR, name = ï..Name, pid = playerid)
SteamBat <- SteamBat %>%
  rename(steamwar = WAR, name = ï..Name, pid1 = playerid)
SteamPitch <- SteamPitch %>%
  rename(steamwar = WAR, name = ï..Name, pid1 = playerid)
ZipsBat <- ZipsBat %>%
  rename(zipwar = WAR, name = ï..Name, pid2 = playerid)
ZipsPitch <- ZipsPitch %>%
  rename(zipwar = WAR, name = ï..Name, pid2 = playerid)
```

```{r}
Batting %>%
  head(3)
Pitching %>%
  head(3)
```
Combined the tables to get data sets with just the name, Wins Above Replacement, and the predictions for Wins Above Replacement

```{r}
Bat1 <- Batting %>%
  inner_join(ZipsBat)

Bat1 <- Bat1 %>%
  group_by(name, war, zipwar) %>%
  summarise()

Bat2 <- Bat1 %>%
  inner_join(FansBat)

Bat2 <- Bat2 %>%
  group_by(name, war, zipwar, fanwar) %>%
  summarise()

Bat3 <- Bat2 %>%
  inner_join(SteamBat)

BatPrediction <- Bat3 %>%
  group_by(name, war, zipwar, fanwar, steamwar) %>%
  summarise()

Pit1 <- Pitching %>%
  inner_join(ZipsPitch)

Pit1 <- Pit1 %>%
  group_by(name, war, zipwar) %>%
  summarise()

Pit2 <- Pit1 %>%
  inner_join(FansPitch)

Pit2 <- Pit2 %>%
  group_by(name, war, zipwar, fanwar) %>%
  summarise()

Pit3 <- Pit2 %>%
  inner_join(SteamPitch)

PitchingPrediction <- Pit3 %>%
  group_by(name, war, zipwar, fanwar, steamwar) %>%
  summarise()
head(BatPrediction)
head(PitchingPrediction)
```
Added the average of the three predicted Wins Above Replacement, and then graphed the WAR compared to the predicted WAR, and did a reggression test on them too to see which prediction method had the least variance.
```{r}
BatPrediction <- BatPrediction %>%
  mutate(averagewar = (zipwar + fanwar + steamwar)/3)
PitchPrediction <- BatPrediction %>%
  mutate(averagewar = (zipwar + fanwar + steamwar)/3)

HittersRegression <- BatPrediction %>%
  lm(war ~ averagewar, data = .)
summary(HittersRegression)

BatPrediction %>%
  ggplot(aes(x = war, y = averagewar)) +
  geom_smooth() +
  geom_point()

HittersRegressionFan <- BatPrediction %>%
  lm(war ~ fanwar, data = .)
summary(HittersRegressionFan)


BatPrediction %>%
  ggplot(aes(x = war, y = fanwar)) +
  geom_smooth() +
  geom_point()

HittersRegressionSteam <- BatPrediction %>%
  lm(war ~ steamwar, data = .)
summary(HittersRegressionSteam)

BatPrediction %>%
  ggplot(aes(x = war, y = steamwar)) +
  geom_smooth() +
  geom_point()

HittersRegressionZip <- BatPrediction %>%
  lm(war ~ zipwar, data = .)
summary(HittersRegressionZip)

BatPrediction %>%
  ggplot(aes(x = war, y = zipwar)) +
  geom_smooth() +
  geom_point()
```
```{r}
PitchersRegression <- PitchPrediction %>%
  lm(war ~ averagewar, data = .)
summary(PitchersRegression)

PitchPrediction %>%
  ggplot(aes(x = war, y = averagewar)) +
  geom_smooth() +
  geom_point()

PitchersRegressionFan <- PitchPrediction %>%
  lm(war ~ fanwar, data = .)
summary(PitchersRegressionFan)

PitchPrediction %>%
  ggplot(aes(x = war, y = fanwar)) +
  geom_smooth() +
  geom_point()

PitchersRegressionSteam <- PitchPrediction %>%
  lm(war ~ steamwar, data = .)
summary(PitchersRegressionSteam)

PitchPrediction %>%
  ggplot(aes(x = war, y = steamwar)) +
  geom_smooth() +
  geom_point()

PitchersRegressionZip <- PitchPrediction %>%
  lm(war ~ zipwar, data = .)
summary(PitchersRegressionZip)

PitchPrediction %>%
  ggplot(aes(x = war, y = zipwar)) +
  geom_smooth() +
  geom_point()
```

Found the exact number of Strikeouts, Walks, and Home Runs allowed for each pitcher

```{r}
Pitching <- Pitching %>%
  mutate(ks = strikeoutper9 * innings / 9) %>%
  mutate(bb = walksper9 * innings / 9) %>%
  mutate(hr = homerunsper9 * innings / 9)
```

Calculated how many plate appearances on average it took to hit a home run

```{r}
Batting <- Batting %>%
  mutate(paperhomerun = pa / homeruns)
```

Graphed many different variables to see if there was any specific stat that has the highest correlation with Wins Above Replacement

```{r}
Batting %>%
  ggplot(aes(x = average, y = war, size = homeruns)) +
  geom_smooth() +
  geom_point()
Batting %>%
  ggplot(aes(x = wrc, y = war)) +
  geom_smooth() +
  geom_point()
Batting %>%
  ggplot(aes(x = homeruns, y = war)) +
  geom_smooth() +
  geom_point()
Batting %>%
  ggplot(aes(x = paperhomerun, y = war)) +
  geom_smooth() +
  geom_point()

Batting %>%
  group_by(name, paperhomerun, war) %>%
  filter(paperhomerun != "Inf") %>%
  summarise() %>%
  arrange(paperhomerun)
```

```{r}
Pitching %>%
  ggplot(aes(x = era, y = war, size = ks)) +
  geom_smooth(aes(x = era, y = war)) +
  geom_point()
Pitching %>%
  ggplot(aes(x = innings, y = war)) +
  geom_smooth(aes(x = innings, y = war)) +
  geom_point()
Pitching %>%
  ggplot(aes(x = ks, y = war)) +
  geom_smooth(aes(x = ks, y = war)) +
  geom_point()
Pitching %>%
  ggplot(aes(x = bb, y = war)) +
  geom_smooth(aes(x = bb, y = war)) +
  geom_point()
Pitching %>%
  ggplot(aes(x = hr, y = war)) +
  geom_smooth(aes(x = hr, y = war)) +
  geom_point()
Pitching %>%
  ggplot(aes(x = era, y = war)) +
  geom_smooth(aes(x = era, y = war)) +
  geom_point()
Pitching %>%
  ggplot(aes(x = fip, y = war)) +
  geom_smooth(aes(x = fip, y = war)) +
  geom_point()
Pitching %>%
  ggplot(aes(x = wins, y = war)) +
  geom_smooth(aes(x = wins, y = war)) +
  geom_point()
```

Reggression to see if Plate Appearence per Home Run was a strong predictor for WAR

```{r}

Reggression <- Batting %>%
  filter(paperhomerun != "Inf") %>%
  lm(war ~ paperhomerun, data = .)
summary(Reggression)
```
```{r}

kmodel <- Pitching %>%
  lm(war ~ ks, data = .)

summary(kmodel)
```

Did regression with a variety of statistics to see what it would determine what the most important factors were for WAR

```{r}
batmodel <- Batting %>%
  rpart(war ~ average + homeruns + wrc + pa + steals + rbi + runs + paperhomerun, data = .)

prp(batmodel)
```

```{r}
pitchmodel <- Pitching %>%
  rpart(war ~ innings + era + ks + fip + bb + hr, data = .)

prp(pitchmodel)
```
